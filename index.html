<!DOCTYPE html>
<html>
<head>
    <title>VSITES Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f8f9fa;
        }

        #tabs {
            display: flex;
            justify-content: center;
            background-color: #ddd;
            padding: 5px;
        }

        .tab {
            margin: 0 5px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            cursor: pointer;
        }

        .tab.active {
            background-color: #fff;
            border-bottom: none;
        }

        #container {
            margin-top: 20px;
        }

        #search-box {
            margin-top: 20px;
        }

        #question {
            width: 400px;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #dfe1e5;
            border-radius: 20px;
            margin-bottom: 10px;
        }

        #search-button {
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            border: none;
            background-color: #f8f9fa;
            cursor: pointer;
        }

        #search-button:hover {
            background-color: #e8eaed;
        }

        #results {
            text-align: left;
            max-width: 800px;
            margin: 20px auto;
            border: none;
        }

        .result {
            margin-bottom: 20px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
        }

        .result h3 {
            color: #1a0dab;
        }

        .result a {
            text-decoration: none;
            color: #1a0dab;
        }

        .result a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div id="tabs">
        <div class="tab active" id="tab1" onclick="switchTab(this)">Search</div>
        <div class="tab" onclick="addTab()">+</div>
    </div>
    <div id="container">
        <div id="search-box">
            <input type="text" id="question" placeholder="Enter your question" onkeypress="handleKeyPress(event)">
            <button id="search-button" onclick="getResults()">Search</button>
        </div>
        <div id="results"></div>
    </div>

    <script>
        let tabCount = 1;
        let searchResults = {};

        function addTab() {
            const newTabId = 'tab' + (++tabCount);

            // Create new tab
            const tab = document.createElement("div");
            tab.className = "tab";
            tab.id = newTabId;
            tab.innerText = "Search";
            tab.onclick = function () { switchTab(this); };
            document.getElementById("tabs").appendChild(tab);

            // Initialize search results for new tab
            searchResults[newTabId] = '';
            switchTab(tab);
        }

        function switchTab(tabElement) {
            Array.from(document.getElementsByClassName("tab")).forEach(tab => {
                tab.classList.remove("active");
            });
            tabElement.classList.add("active");

            // Update search box and results based on selected tab
            const tabId = tabElement.id;
            document.getElementById("question").value = '';
            document.getElementById("results").innerHTML = searchResults[tabId];
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                getResults();
            }
        }

        async function getResults() {
            const activeTabId = document.querySelector('.tab.active').id;
            const question = document.getElementById("question").value;
            const resultsElement = document.getElementById("results");

            // Fetch manifest data and process results
            const manifestData = await fetchManifestData();
            const matchedResults = matchQueryWithManifestData(question, manifestData);

            resultsElement.innerHTML = '';
            matchedResults.forEach(item => {
                resultsElement.innerHTML += `
                    <div class="result">
                        <h3><a href="${item['result-click-url']}">${item['result-title-text']}</a></h3>
                        <p>${item['result-description']}</p>
                    </div>
                `;
            });

            // Save results for current tab
            searchResults[activeTabId] = resultsElement.innerHTML;
        }

        async function fetchManifestData() {
            try {
                const response = await fetch('https://alexosthebestnet.github.io/X/VSITES.json');
                return await response.json();
            } catch (error) {
                console.error("Error fetching manifest data:", error);
                return [];
            }
        }

        function matchQueryWithManifestData(query, manifestData) {
            const lowerCaseQuery = query.toLowerCase();
            return manifestData.filter(item => {
                const titleMatch = item["result-title-text"].toLowerCase().includes(lowerCaseQuery);
                const descriptionMatch = item["result-description"].toLowerCase().includes(lowerCaseQuery);
                return titleMatch || descriptionMatch;
            });
        }

        // Initialize search results for first tab
        searchResults['tab1'] = '';
    </script>
</body>
</html>
